SET NOCOUNT ON; select top 0 PRE.PARTY_ID ,(select distinct DEALER_NUMBER from C_B_DEALER where PRE.DEALER_ID=C_B_DEALER.ROWID_OBJECT) DEALER_NO ,PRE.RELATION_START_DATE,PRE.RELATION_END_DATE ,PRE.BRAND_ID ,(select distinct DESCRIPTION from C_LU_DEALER_TYPE where code=PRE.RELATION_TYPE) TYPE from C_B_PREFERRED_DEALER PRE where exists(select 1 from C_B_PARTY where PRE.PARTY_ID=C_B_PARTY.ROWID_OBJECT and TYPE='P' and C_B_PARTY.HUB_STATE_IND=1 and exists(select 1 from C_B_PARTY_STATUS where PRE.PARTY_ID=PARTY_ID and STATUS_CODE=1 and C_B_PARTY_STATUS.HUB_STATE_IND=1 and STATUS_TYPE in('A','L'))) and PRE.HUB_STATE_IND=1 and PRE.STATUS_CODE=1 and PRE.RELATION_END_DATE is null and PRE.RELATION_START_DATE>getdate()-365